# Сar-number-detection
Проект реализуется в рамках курса по глубокому обучению.



## Задача
Задача стояла в следующем:
Существует предприятие, директора интересуют автомобильные номера. Есть камера, она шлет поток, мы из него выделяем фото. Распознаем:
<ul>
<li>Российские номера</li>
<li>Тип автомобиля</li>
<li>Цвет автомобиля</li>
<li>Кто из работников уезжает домой пораньше</li>
</ul>
Важно запоминать в какое время приехала машина, не обязательно сохранять сами данные о машине и сотруднике и ее номера.

## Quick Start

Чтобы запустить проект локально, необходимо:
1. Создать виртуальное окружение
2. Установить зависимости из requirements.txt
3. Проверить пути до весов/видео
4. python main.py

## Решение
Для распознавания автомобиля по типам и номерного знака на изображении была дообучена YOLOv5.
Пайплайн выглядит следующим образом:
1. Сначала определяется, что бокс номера лежит внутри бокса машины, тогда номерной знак присваивается этой машине
2. Записывается тип машины и координаты номера и бокса автомобиля
3. Затем происходит распознавание номера машины и проверка распознанного номера по регулярному выражению
4. Производится распознование цвета автомобиля
5. Все данные записываются в базу данных со временем, когда проиходила детекция

Пример распознавания на изображении ниже:

<br>
<img width="499" alt="Снимок экрана 2022-10-05 в 13 49 00" src="https://user-images.githubusercontent.com/27068383/194070341-2552f638-3700-4bac-8a88-942cc462a5de.png">


Для распознавания номера на номерных знаках сначала использовался tesseract, но точность получилась низкая:
<br>
![2022-10-05 16 55 17](https://user-images.githubusercontent.com/27068383/194079080-494d75e1-ec2c-44c9-9404-e665737329ff.jpg)
<br>
<p>После этого было принято решение обучить нейросеть архитектуры LPRnet. Точность распознавания текста 89,6%.</p>


## Датасет

Датасет состоит из 4 классов:

- 0 - номера автомобилей
- 1 - легковые автомобили
- 2 - грузовые автомобили
- 3 - общественный транспорт

### Train/test split

**В обучающей выборке:** 1200 изображений (92%)

**В тестовой выборке:** 103 изображения (8%)


# Описание обученных моделей
В задаче распознавания объектов на изображении были проведены эксперименты с обучением моделей на сетях с разной архитектурой. Все гиперпараметры в YOLO изначально подобраны оптимальным образом, мы меняли только архитектуру, чтобы получить наиболее точную.

## Модель YOLOv5n


|  Класс | mAP50 | mAP50-95 |
| --- | --- | --- |
| Для всех | 0.848 | 0.726 |
| 0 (Номерные знаки) | 0.932 | 0.69 |
| 1 (Легковые автомобили) | 0.859 | 0.795 |
| 2 (Грузовые автомобили) | 0.839 | 0.762 |
| 3 (Общественный транспорт) | 0.761 | 0.658 |


## Модель YOLOv5s

|  Класс | mAP50 | mAP50-95 |
| --- | --- | --- |
| Для всех | 0.807 | 0.709 |
| 0 (Номерные знаки) | 0.91 | 0.691 |
| 1 (Легковые автомобили) | 0.827 | 0.786 |
| 2 (Грузовые автомобили) | 0.777 | 0.723 |
| 3 (Общественный транспорт) | 0.712 | 0.635 |

## Модель YOLOv5m
Модель была обучена на 19 эпохах, так как размер датасета был слишком маленьким для сети такого размера.


|  Класс | mAP50 | mAP50-95 |
| --- | --- | --- |
| Для всех | 0.848 | 0.726 |
| 0 (Номерные знаки) | 0.932 | 0.69 |
| 1 (Легковые автомобили) | 0.859 | 0.795 |
| 2 (Грузовые автомобили) | 0.839 | 0.762 |
| 3 (Общественный транспорт) | 0.761 | 0.658 |


